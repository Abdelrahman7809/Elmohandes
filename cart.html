<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f8f9fa;
            padding: 20px;
            text-align: center;
        }

        .fa-minus {
            color: red;
            font-size: 14px;
            border: none;
            background: none;
        }

        .fa-plus {
            color: green;
            font-size: 15px;
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            max-width: 700px;
            margin: auto;
            border-collapse: collapse;
            background-color: white;
        }

        th,
        td {
            padding: 12px;
            border: 1px solid #cecece;
        }

        .btns {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .action-btn {
            background-color: #2e2e2e;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 16px;
            cursor: pointer;
            white-space: nowrap;
        }

        .confirm-btn {
            background-color: green;
        }

        .delete-btn {
            background-color: #ff0000;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .quantity-btn {
            margin: 0 5px;
            cursor: pointer;
        }

        h3 {
            margin-top: 20px;
        }

        #clearCartBtn {
            background-color: #dc3545;
            color: white;
        }
    </style>
</head>
<body>
    <h2>ğŸ›’ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
    <div id="cartContainer"></div>

    <div class="btns">
        <button id="confirmOrderBtn" class="action-btn confirm-btn">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
        <button id="clearCartBtn" class="action-btn" style="background-color: #b30000;">ğŸ—‘ï¸ ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
        <a href="index.html" class="action-btn">ğŸ  Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ØªØ¬Ø±</a>
        <a href="my_orders.html" class="action-btn">ğŸ“„ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø·Ù„Ø¨Ø§ØªÙŠ</a>
    </div>

    <script>
        let cart = JSON.parse(localStorage.getItem("cart")) || [];

        function updateCart() {
            localStorage.setItem("cart", JSON.stringify(cart));
            renderCart();
        }

        function increaseQuantity(index) {
            cart[index].quantity += 1;
            updateCart();
        }

        function decreaseQuantity(index) {
            if (cart[index].quantity > 1) {
                cart[index].quantity -= 1;
            } else {
                cart.splice(index, 1); // Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ø°Ø§ Ø§Ù„ÙƒÙ…ÙŠØ© Ø£ØµØ¨Ø­Øª 0
            }
            updateCart();
        }

        function removeItem(index) {
            cart.splice(index, 1);
            updateCart();
        }

        function clearCart() {
            Swal.fire({
                title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
                text: "Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ø³Ù„Ø©.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø­Ø°Ù!',
                cancelButtonText: 'Ù„Ø§ØŒ Ø¥Ù„ØºØ§Ø¡!'
            }).then((result) => {
                if (result.isConfirmed) {
                    cart = [];
                    updateCart();
                    Swal.fire('ØªÙ… Ø§Ù„Ø­Ø°Ù!', 'ØªÙ… ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­.', 'success');
                }
            });
        }

        function renderCart() {
            try {
                if (cart.length === 0) {
                    document.getElementById("cartContainer").innerHTML = "<p>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠÙ‹Ø§</p>";
                    return;
                }

                let total = 0;
                let table =
                    '<table><thead><tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø­Ø°Ù</th></tr></thead><tbody>';

                cart.forEach((item, index) => {
                    const subtotal = item.price * item.quantity;
                    total += subtotal;
                    table += `
                        <tr>
                            <td>${item.name}</td>
                            <td>${item.price.toFixed(2)} LE</td>
                            <td>
                                <button class="quantity-btn" onclick="decreaseQuantity(${index})"><i class="fa-solid fa-minus"></i></button>
                                ${item.quantity}
                                <button class="quantity-btn" onclick="increaseQuantity(${index})"><i class="fa-solid fa-plus"></i></button>
                            </td>
                            <td>${subtotal.toFixed(2)} LE</td>
                            <td><button class="delete-btn" onclick="removeItem(${index})">Ø­Ø°Ù</button></td>
                        </tr>
                    `;
                });

                table += `</tbody></table><h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ = ${total.toFixed(2)} LE</h3>`;
                document.getElementById("cartContainer").innerHTML = table;
            } catch (error) {
                console.error("Error rendering cart:", error);
                document.getElementById("cartContainer").innerHTML =
                    "<p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§.</p>";
            }
        }

        async function confirmOrder() {
            try {
                const currentCart = JSON.parse(localStorage.getItem("cart")) || [];

                if (currentCart.length === 0) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©',
                        text: 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ù‚Ø¨Ù„ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨',
                        confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§'
                    });
                    return;
                }

                const orders = JSON.parse(localStorage.getItem("orders")) || [];

                const newOrder = {
                    id: Date.now(),
                    date: new Date().toLocaleString("ar-EG"),
                    items: currentCart
                };

                orders.push(newOrder);
                localStorage.setItem("orders", JSON.stringify(orders));
                localStorage.removeItem("cart");

                Swal.fire({
                    icon: 'success',
                    title: 'ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨',
                    html: `âœ… ØªÙ… Ø­ÙØ¸ Ø·Ù„Ø¨Ùƒ<br>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: <strong>${newOrder.id}</strong><br>ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ù‡Ø¯Ø© ØªÙØ§ØµÙŠÙ„Ù‡ Ù…Ù† ØµÙØ­Ø© Ø·Ù„Ø¨Ø§ØªÙŠ`,
                    confirmButtonText: 'Ù…ÙˆØ§ÙÙ‚',
                    confirmButtonColor: '#7b4fff'
                }).then(() => {
                    cart.length = 0;
                    renderCart();
                });

            } catch (error) {
                console.error("Error confirming order:", error);
                Swal.fire({
                    icon: 'error',
                    title: 'Ø®Ø·Ø£',
                    text: 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.',
                });
            }
        }

        document.getElementById("confirmOrderBtn").addEventListener("click", confirmOrder);
        document.getElementById("clearCartBtn").addEventListener("click", clearCart);

        renderCart();
    </script>
</body>
</html>
